<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KIZHI Tic Tac Toe</title>
<style>
body {
    font-family: Arial, sans-serif;
    text-align: center;
    margin: 0;
    padding: 0;
    background-color: black;
    color: white;
    transition: background 0.3s, color 0.3s;
}
h1 { margin: 20px 0; }
#board {
    display: grid;
    grid-template-columns: repeat(3, 100px);
    grid-gap: 10px;
    justify-content: center;
    margin: 20px auto;
}
.cell {
    width: 100px;
    height: 100px;
    font-size: 48px;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    transition: background 0.3s, transform 0.2s;
    border-radius: 10px;
}
.cell:hover { transform: scale(1.1); }
button, select { margin: 5px; padding: 10px; font-size: 16px; cursor: pointer; border-radius: 5px; }
#popup {
    position: fixed; top:0; left:0; width:100%; height:100%;
    display:flex; justify-content:center; align-items:center;
    background: rgba(0,0,0,0.7); color:white; font-size:48px; font-weight:bold;
    display:none; z-index:10; animation: popupAnim 0.5s ease-out;
}
@keyframes popupAnim {
    0% { transform: scale(0); opacity:0; }
    50% { transform: scale(1.2); opacity:1; }
    100% { transform: scale(1); opacity:1; }
}
#confetti-canvas {
    position: fixed; top:0; left:0; width:100%; height:100%; pointer-events: none; z-index: 20;
}
</style>
</head>
<body>

<h1>KIZHI Tic Tac Toe</h1>
<div id="board"></div>
<div>
    <button onclick="resetGame()">Reset</button>
    <button onclick="switchTheme()">Switch Theme</button>
    <button onclick="showHint()">Hint</button>
    <select id="mode" onchange="setMode(this.value)">
        <option value="PVC">Player vs AI</option>
        <option value="PVP">Player vs Player</option>
    </select>
    <select id="level" onchange="setLevel(this.value)">
        <option value="low">Low</option>
        <option value="medium" selected>Medium</option>
        <option value="tough">Tough</option>
    </select>
</div>
<h2 id="turn">Turn: Player 1 (X)</h2>
<h2 id="score">Player 1: 0 | Player 2 / AI: 0</h2>

<div id="popup"></div>
<canvas id="confetti-canvas"></canvas>

<audio id="move-sound" src="move.mp3"></audio>
<audio id="win-sound" src="win.mp3"></audio>
<!-- Footer -->
<footer style="
    margin-top: 20px; 
    font-size: 18px; 
    font-weight: bold;
    color: #fff; 
    text-shadow: 0 0 5px #fff, 0 0 10px #ff00ff, 0 0 20px #00ffff;
    animation: glow 2s infinite alternate;
">
    Developed by VETRIVEL M
</footer>

<style>
@keyframes glow {
    0% { text-shadow: 0 0 5px #ff0000, 0 0 10px #ff6600, 0 0 20px #ffcc00; color: #ff0000; }
    25% { text-shadow: 0 0 5px #ff00ff, 0 0 10px #6600ff, 0 0 20px #00ccff; color: #ff00ff; }
    50% { text-shadow: 0 0 5px #00ff00, 0 0 10px #00cc66, 0 0 20px #66ffcc; color: #00ff00; }
    75% { text-shadow: 0 0 5px #00ffff, 0 0 10px #0066ff, 0 0 20px #cc00ff; color: #00ffff; }
    100% { text-shadow: 0 0 5px #ff0000, 0 0 10px #ff6600, 0 0 20px #ffcc00; color: #ff0000; }
}
</style>

<script>
// ----------------- Game Variables -----------------
let board = Array(9).fill('');
let currentPlayer = 'X';
let vsAI = true;
let aiLevel = 'medium';
let darkMode = true;
let score = {X:0, O:0};

const colors = ['#FF6F61','#6B5B95','#88B04B','#F7CAC9','#92A8D1','#955251','#B565A7','#009B77','#DD4124'];
const boardDiv = document.getElementById('board');
const popupDiv = document.getElementById('popup');
const scoreDiv = document.getElementById('score');

// ----------------- Board Rendering -----------------
function renderBoard() {
    boardDiv.innerHTML = '';
    board.forEach((cell,i)=>{
        const div = document.createElement('div');
        div.className='cell';
        div.style.backgroundColor = colors[i];
        div.textContent = cell;
        div.onmouseenter = ()=> div.style.backgroundColor='#FFFF00';
        div.onmouseleave = ()=> div.style.backgroundColor=colors[i];
        div.onclick = ()=>playerMove(i);
        boardDiv.appendChild(div);
    });
}
renderBoard();

// ----------------- Sounds -----------------
function playSound(id){
    const audio=document.getElementById(id);
    audio.currentTime=0; audio.play();
}

// ----------------- Popup -----------------
function showPopup(message){
    popupDiv.textContent=message;
    popupDiv.style.display='flex';
    setTimeout(()=> popupDiv.style.display='none',1500);
}

// ----------------- Player Move -----------------
function playerMove(i){
    if(board[i]!=='') return;
    board[i]=currentPlayer;
    playSound('move-sound');
    animateCell(i);
    updateBoard();
    if(checkWinner(currentPlayer)){
        playSound('win-sound');
        score[currentPlayer]++; updateScore();
        showPopup(`${currentPlayer} Wins!`);
        startConfetti(); setTimeout(resetGame,2000);
        return;
    }
    if(!board.includes('')){ showPopup('Draw!'); setTimeout(resetGame,2000); return; }

    if(vsAI && currentPlayer==='X'){
        currentPlayer='O';
        document.getElementById('turn').textContent='Turn: AI (O)';
        setTimeout(aiMove,500);
    } else {
        currentPlayer = currentPlayer==='X'?'O':'X';
        document.getElementById('turn').textContent=`Turn: ${currentPlayer==='X'?'Player 1 (X)':'Player 2 (O)'}`;
    }
}

// ----------------- AI Move -----------------
function aiMove(){
    let idx=getAIMove();
    if(idx!==null){
        board[idx]='O';
        playSound('move-sound');
        flashAIMove(idx);
        updateBoard();
        if(checkWinner('O')){
            playSound('win-sound');
            score['O']++; updateScore();
            showPopup(`AI Wins!`);
            startConfetti(); setTimeout(resetGame,2000);
            return;
        }
        currentPlayer='X';
        document.getElementById('turn').textContent='Turn: Player 1 (X)';
    }
}

// ----------------- Animations -----------------
function animateCell(i){
    const cell = boardDiv.children[i];
    cell.style.transform='scale(1.2)';
    setTimeout(()=>cell.style.transform='scale(1)',200);
}

function flashAIMove(i){
    const cell = boardDiv.children[i];
    let flashes=0;
    const flashInterval=setInterval(()=>{
        cell.style.backgroundColor=colors[Math.floor(Math.random()*colors.length)];
        flashes++;
        if(flashes>5){ clearInterval(flashInterval); cell.style.backgroundColor=colors[i]; }
    },100);
}

// ----------------- AI Logic -----------------
function getAIMove(){
    const empty=board.map((v,i)=>v===''?i:null).filter(v=>v!==null);
    if(empty.length===0) return null;
    if(aiLevel==='low') return empty[Math.floor(Math.random()*empty.length)];
    if(aiLevel==='medium') return Math.random()<0.5 ? empty[Math.floor(Math.random()*empty.length)] : minimax('O',true).index;
    if(aiLevel==='tough') return minimax('O',true).index;
}

function minimax(player,isRoot=false){
    const opponent = player==='X'?'O':'X';
    const empty=board.map((v,i)=>v===''?i:null).filter(v=>v!==null);
    if(checkWinner('O')) return {score:1};
    if(checkWinner('X')) return {score:-1};
    if(empty.length===0) return {score:0};
    let moves=[];
    for(let i of empty){
        board[i]=player;
        const result=minimax(opponent);
        moves.push({index:i,score:result.score});
        board[i]='';
    }
    if(player==='O'){
        const best = moves.reduce((a,b)=>a.score>b.score?a:b);
        return isRoot?best:{score:best.score};
    } else {
        const best = moves.reduce((a,b)=>a.score<b.score?a:b);
        return isRoot?best:{score:best.score};
    }
}

// ----------------- Utility -----------------
function checkWinner(player){
    const winCond=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
    return winCond.some(([a,b,c])=>board[a]===player && board[b]===player && board[c]===player);
}

function updateBoard(){ renderBoard(); }
function resetGame(){ board=Array(9).fill(''); currentPlayer='X'; updateBoard(); document.getElementById('turn').textContent='Turn: Player 1 (X)'; }
function switchTheme(){ darkMode=!darkMode; document.body.style.backgroundColor=darkMode?'black':'white'; document.body.style.color=darkMode?'white':'black'; }
function setMode(mode){ vsAI = mode==='PVC'; resetGame(); }
function setLevel(level){ aiLevel=level; }
function showHint(){
    if(vsAI){
        const hint = minimax('X',true).index;
        const cell = boardDiv.children[hint];
        const original = cell.style.backgroundColor;
        cell.style.backgroundColor = '#00FF00';
        setTimeout(()=>cell.style.backgroundColor=original,500);
    } else alert('Hint available only in PVC mode');
}
function updateScore(){ scoreDiv.textContent=`Player 1: ${score.X} | Player 2 / AI: ${score.O}`; }

// ----------------- Confetti -----------------
const confettiCanvas=document.getElementById('confetti-canvas');
const ctx=confettiCanvas.getContext('2d');
let confettiParticles=[];

function resizeCanvas(){ confettiCanvas.width=window.innerWidth; confettiCanvas.height=window.innerHeight; }
window.addEventListener('resize',resizeCanvas);
resizeCanvas();

function createConfetti(count=150){
    confettiParticles=[];
    for(let i=0;i<count;i++){
        confettiParticles.push({
            x: Math.random()*window.innerWidth,
            y: Math.random()*window.innerHeight - window.innerHeight,
            r: Math.random()*6 + 4,
            d: Math.random()*20 + 10,
            color: `hsl(${Math.random()*360},100%,50%)`,
            tilt: Math.random()*10 - 10,
            tiltAngleIncrement: Math.random()*0.07 + 0.05,
            tiltAngle: 0
        });
    }
}

function drawConfetti(){
    ctx.clearRect(0,0,window.innerWidth,window.innerHeight);
    confettiParticles.forEach(p=>{
        ctx.beginPath();
        ctx.lineWidth=p.r/2;
        ctx.strokeStyle=p.color;
        ctx.moveTo(p.x+p.tilt+p.r/4,p.y);
        ctx.lineTo(p.x+p.tilt,p.y+p.tilt+p.r/4);
        ctx.stroke();
    });
    updateConfetti();
}

function updateConfetti(){
    confettiParticles.forEach(p=>{
        p.tiltAngle += p.tiltAngleIncrement;
        p.y += (Math.cos(p.d)+3+p.r/2)/2;
        p.tilt = Math.sin(p.tiltAngle)*15;
        if(p.y>window.innerHeight) p.y=-10;
    });
    requestAnimationFrame(drawConfetti);
}

function startConfetti(duration=2000){
    createConfetti();
    drawConfetti();
    setTimeout(()=> confettiParticles=[],duration);
}
</script>

</body>
</html>
